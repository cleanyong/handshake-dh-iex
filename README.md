下面给你 两台 IEx 会话（Alice 与 Bob） 的逐步命令。流程清晰：先各自在各自的 IEx 中计算并打印自己的公钥，然后互相交换（把公钥的十进制整数拷贝/粘贴给对方），接着用对方的公钥和自己的私钥分别算出共享密钥并验证两边相等。最后示范如何从共享秘密派生一个 256-bit 对称密钥（SHA-256）。

说明： :crypto.mod_pow(g, x, p) 返回 binary，用 :binary.decode_unsigned/1 得到 Elixir 的大整数。为可信交换，把公钥作为十进制整数发送（直接把 IEx 打印出的整数复制过去）。

⸻

Alice 的 IEx 会话（iex-A）
	1.	启动 iex，在 Alice 机器里粘入（或逐行输入）：

# 1) 设定公参 p 和 g（可只在一端设，但示例里两端都设）
p = 28766814515305344925135327846265618912664117797851731587904878015462803249977235941249703516789944091749898600299383135916258394165277154746850690924885409374613186677403293002561212823872134794612885736588353062665100257458192024578240831157340603512117881798371957928710301007355966949768954314381974229634562328230946414283068159460377595218094419073047560165707147374992696155554785175464279458669266476082782086850251603744388440411967541655962957589131628215119151589278605243618074656948031279999629258824412353704611067503482710930591891408577064246882098497237368756242458991599578221980723033002346183986743

g = 2

	2.	把 Alice 的私钥 a_priv 设为你给的长整数（粘入一整行）：

a_priv = 4511959030895691745070800409480182188566523794625165276102118470374784513132699890655231264740029503398505045028813336916372778525250082436581185848819153996165727815930228435001829887122262635865896844517560205978310297860745079220669122124329097857918549984481868449861031823049023715786537193417805624114454089297658381333381772269975519518127953370831747065866802653663110293389764492067298516242615750870712283957444318705920578014392399945260847677847865782391157222220918765161717084198837677396345570248944364370987231953947779576766926123015740775003036034599921733496579953286816135584137019229626117328298

	3.	计算并打印 Alice 的公钥 a_pub（并以十进制显示，便于传给 Bob）：

a_pub_bin = :crypto.mod_pow(g, a_priv, p)
a_pub = :binary.decode_unsigned(a_pub_bin)
IO.puts("Alice pub (decimal):")
IO.puts(Integer.to_string(a_pub))
# 或者打印 hex:
IO.puts("Alice pub (hex): " <> Base.encode16(:binary.encode_unsigned(a_pub), case: :lower))

把 Alice pub (decimal) 那个长十进制整数复制并发给 Bob（通过粘贴/消息等）。

⸻

Bob 的 IEx 会话（iex-B）
	1.	启动另一个 iex，会话里先设定相同的 p 与 g：

p = 28766814515305344925135327846265618912664117797851731587904878015462803249977235941249703516789944091749898600299383135916258394165277154746850690924885409374613186677403293002561212823872134794612885736588353062665100257458192024578240831157340603512117881798371957928710301007355966949768954314381974229634562328230946414283068159460377595218094419073047560165707147374992696155554785175464279458669266476082782086850251603744388440411967541655962957589131628215119151589278605243618074656948031279999629258824412353704611067503482710930591891408577064246882098497237368756242458991599578221980723033002346183986743

g = 2

	2.	在 Bob 端设置 Bob 的私钥 b_priv（你给的那个长整数）：

b_priv = 6575457246570185347798020309482764971229567148448782518054746038122056771867338309252925544314264534498486744660561204428436933129742773559821791449800517429801626548411186097020054274106289631332380896220073300682697206054462724924328343627424545203045888558675584509943613585498673806063774789641711677320950549404014453962232194357601778489618825099346633969720758417206991249081332730883499206300786824512167747434344091930679621676242297211166449613671057877940242369481545343160146563060522625900821064218728248191194593822552545894569037603346148216581933820400831759698819586781238662912715600185198893991335

	3.	计算并显示 Bob 的公钥 b_pub，把十进制整数发给 Alice：

b_pub_bin = :crypto.mod_pow(g, b_priv, p)
b_pub = :binary.decode_unsigned(b_pub_bin)
IO.puts("Bob pub (decimal):")
IO.puts(Integer.to_string(b_pub))
# hex 表示（可选）:
IO.puts("Bob pub (hex): " <> Base.encode16(:binary.encode_unsigned(b_pub), case: :lower))

把 Bob pub (decimal) 这个整数复制并发回给 Alice。

⸻

回到 Alice（iex-A）——计算共享密钥
	4.	Alice 收到 Bob 发来的 b_pub（十进制整数），在 Alice 的 IEx 中把它粘贴为变量，然后计算共享密钥：

# 假设你把 Bob 给你的十进制粘贴为 b_pub_received
b_pub_received = <paste Bob pub decimal here>

# 计算共享 secret（binary -> integer）
shared_bin_alice = :crypto.mod_pow(b_pub_received, a_priv, p)
shared_int_alice = :binary.decode_unsigned(shared_bin_alice)

IO.puts("Alice computed shared (decimal):")
IO.puts(Integer.to_string(shared_int_alice))

# 派生 256-bit 对称 key（SHA-256）
sym_key_alice = :crypto.hash(:sha256, :binary.encode_unsigned(shared_int_alice))
IO.puts("Derived AES key (hex): " <> Base.encode16(sym_key_alice, case: :lower))

把 Alice computed shared (decimal)（或 Derived AES key）保存/记录以便比对。

⸻

回到 Bob（iex-B）——计算共享密钥并比较
	5.	Bob 收到 Alice 的 a_pub（十进制整数），在 Bob 的 IEx 中把它粘贴为变量，然后计算共享密钥：

a_pub_received = <paste Alice pub decimal here>

shared_bin_bob = :crypto.mod_pow(a_pub_received, b_priv, p)
shared_int_bob = :binary.decode_unsigned(shared_bin_bob)

IO.puts("Bob computed shared (decimal):")
IO.puts(Integer.to_string(shared_int_bob))

# 派生 256-bit 对称 key（SHA-256）
sym_key_bob = :crypto.hash(:sha256, :binary.encode_unsigned(shared_int_bob))
IO.puts("Derived AES key (hex): " <> Base.encode16(sym_key_bob, case: :lower))


⸻

验证两边相等（任一端都可比对）
	•	Alice 与 Bob 打印出的 shared_int_* 应该完全相同（十进制数一致）。
	•	或者比对对称 key 的 hex 表示 sym_key_alice 与 sym_key_bob 是否相同（更常用）：

# 比对举例（在 Alice 端，你也可以把 Bob 的 sym_key 发过来然后比较字符串）
Base.encode16(sym_key_alice, case: :lower) == Base.encode16(sym_key_bob, case: :lower)
# => true (若一切正确)


⸻

补充说明 / 小贴士
	•	:crypto.mod_pow/3 在 Erlang/OTP 中是适合大整数的模幂实现，速度快且不产生巨大的中间整数。
	•	:binary.decode_unsigned/1 将 :crypto.mod_pow 的 binary 输出变回 Elixir 的大整数，便于打印或进一步操作。
	•	为了实际使用对称密钥（如 AES），不要直接使用大整数 shared_int，而是用 :crypto.hash(:sha256, :binary.encode_unsigned(shared_int)) 或 HKDF 派生你需要的长度（如 256-bit）。
	•	如果你想把公钥以 hex 形式发给对方，可用 Base.encode16(:binary.encode_unsigned(pub_int), case: :lower) 发，并在对方收到后用 :binary.decode_unsigned(Base.decode16!(hex, case: :mixed)) 恢复整数。

⸻

照着上面步骤执行，你就能在两台 IEx 会话中完成完整的 DH 握手演示（交换公钥 → 各自计算共享密钥 → 验证相等）。需要我把上面的命令直接生成为两段可复制粘贴的脚本（Alice & Bob），方便你直接 paste 到两边的 iex 中运行吗？


# ALICE iex
```
iex(2)> p = 28766814515305344925135327846265618912664117797851731587904878015462803249977235941249703516789944091749898600299383135916258394165277154746850690924885409374613186677403293002561212823872134794612885736588353062665100257458192024578240831157340603512117881798371957928710301007355966949768954314381974229634562328230946414283068159460377595218094419073047560165707147374992696155554785175464279458669266476082782086850251603744388440411967541655962957589131628215119151589278605243618074656948031279999629258824412353704611067503482710930591891408577064246882098497237368756242458991599578221980723033002346183986743
28766814515305344925135327846265618912664117797851731587904878015462803249977235941249703516789944091749898600299383135916258394165277154746850690924885409374613186677403293002561212823872134794612885736588353062665100257458192024578240831157340603512117881798371957928710301007355966949768954314381974229634562328230946414283068159460377595218094419073047560165707147374992696155554785175464279458669266476082782086850251603744388440411967541655962957589131628215119151589278605243618074656948031279999629258824412353704611067503482710930591891408577064246882098497237368756242458991599578221980723033002346183986743
iex(3)> 
nil
iex(4)> g = 2
2
iex(5)> a_priv = 4511959030895691745070800409480182188566523794625165276102118470374784513132699890655231264740029503398505045028813336916372778525250082436581185848819153996165727815930228435001829887122262635865896844517560205978310297860745079220669122124329097857918549984481868449861031823049023715786537193417805624114454089297658381333381772269975519518127953370831747065866802653663110293389764492067298516242615750870712283957444318705920578014392399945260847677847865782391157222220918765161717084198837677396345570248944364370987231953947779576766926123015740775003036034599921733496579953286816135584137019229626117328298
4511959030895691745070800409480182188566523794625165276102118470374784513132699890655231264740029503398505045028813336916372778525250082436581185848819153996165727815930228435001829887122262635865896844517560205978310297860745079220669122124329097857918549984481868449861031823049023715786537193417805624114454089297658381333381772269975519518127953370831747065866802653663110293389764492067298516242615750870712283957444318705920578014392399945260847677847865782391157222220918765161717084198837677396345570248944364370987231953947779576766926123015740775003036034599921733496579953286816135584137019229626117328298
iex(6)> a_pub_bin = :crypto.mod_pow(g, a_priv, p)
<<122, 137, 28, 54, 236, 94, 119, 17, 21, 223, 91, 212, 158,
  81, 237, 54, 4, 220, 205, 155, 155, 226, 209, 93, 152, 71,
  54, 71, 147, 237, 111, 79, 117, 235, 66, 222, 160, 125,
  139, 73, 211, 18, 0, 15, 81, 247, 242, 25, 135, 18, ...>>
iex(7)> a_pub = :binary.decode_unsigned(a_pub_bin)
15468684771838238358932531496028223599028751769262450618321942259199011442712199219111290768666347378279484788157492711550727921297392113633793454804178539843057437315344298883184040610898184693677801731392201663410098578467049336760365664462694260410095405772150707764915531790421133264893762622705275797444533899472890261903255131401200519273058652187357611519927211650165834143520955642119960455105294562337102614397635631370149129046690845214202950926562528107115420010286461192355329940137038775796431499622525988185189283466873107209728861896338266832206689470334001461063471260341891607467287796477314659676677
iex(8)> b_pub_received =  7202833918882895413941488044670599667229863337239161342690220627829746114577669328793293789089814194612159772400716626359910616923378193304367488663437487013343244862475254488488006189128268200219147449689124128757901080330928092982518773675767660201032491378685154242406223787069045395511687708275760262854306386083557843944511558153383764526825815722191083211027593575970717325446980420287548767678034399825736230627872058934396248474935092342036232119452197598237720530137165021713859598209917717006950495685445193293137922852096939200218760628610232325496480264154932539926710448746823287613672825979828511687417
7202833918882895413941488044670599667229863337239161342690220627829746114577669328793293789089814194612159772400716626359910616923378193304367488663437487013343244862475254488488006189128268200219147449689124128757901080330928092982518773675767660201032491378685154242406223787069045395511687708275760262854306386083557843944511558153383764526825815722191083211027593575970717325446980420287548767678034399825736230627872058934396248474935092342036232119452197598237720530137165021713859598209917717006950495685445193293137922852096939200218760628610232325496480264154932539926710448746823287613672825979828511687417
iex(9)> shared_bin_alice = :crypto.mod_pow(b_pub_received, a_priv, p)
<<47, 232, 80, 171, 32, 6, 99, 142, 39, 29, 206, 25, 65, 59,
  57, 178, 169, 112, 34, 255, 165, 140, 176, 53, 159, 64,
  202, 52, 10, 110, 74, 198, 112, 252, 166, 128, 165, 147,
  144, 24, 127, 143, 88, 12, 43, 55, 103, 251, 129, 116,
  ...>>
iex(10)> shared_int_alice = :binary.decode_unsigned(shared_bin_alice)
6047759184385469335156370811930744512345790997511266449321764769566423644869090071192385534942749590956534312244306929523110089101528933528047206435499678714592298714427879081456674026811116340356230630610171385140820703908563446330424349716984378196347448282180911695905543899104479615320901426655593284798373208264452945744335207584695216888684979041996427050611902522416147640873292026468973414070462485349907159864176780590718984043264446036720033125252773914606337925882738411182236955509210186077361440866441438886069197478131305510584433678398346078342488183359949710207160034112259943030407096425819679638795
```


# BOB iex
```
iex(1)> g = 2
2
iex(2)> p = 28766814515305344925135327846265618912664117797851731587904878015462803249977235941249703516789944091749898600299383135916258394165277154746850690924885409374613186677403293002561212823872134794612885736588353062665100257458192024578240831157340603512117881798371957928710301007355966949768954314381974229634562328230946414283068159460377595218094419073047560165707147374992696155554785175464279458669266476082782086850251603744388440411967541655962957589131628215119151589278605243618074656948031279999629258824412353704611067503482710930591891408577064246882098497237368756242458991599578221980723033002346183986743
28766814515305344925135327846265618912664117797851731587904878015462803249977235941249703516789944091749898600299383135916258394165277154746850690924885409374613186677403293002561212823872134794612885736588353062665100257458192024578240831157340603512117881798371957928710301007355966949768954314381974229634562328230946414283068159460377595218094419073047560165707147374992696155554785175464279458669266476082782086850251603744388440411967541655962957589131628215119151589278605243618074656948031279999629258824412353704611067503482710930591891408577064246882098497237368756242458991599578221980723033002346183986743
iex(3)> b_priv = 6575457246570185347798020309482764971229567148448782518054746038122056771867338309252925544314264534498486744660561204428436933129742773559821791449800517429801626548411186097020054274106289631332380896220073300682697206054462724924328343627424545203045888558675584509943613585498673806063774789641711677320950549404014453962232194357601778489618825099346633969720758417206991249081332730883499206300786824512167747434344091930679621676242297211166449613671057877940242369481545343160146563060522625900821064218728248191194593822552545894569037603346148216581933820400831759698819586781238662912715600185198893991335
6575457246570185347798020309482764971229567148448782518054746038122056771867338309252925544314264534498486744660561204428436933129742773559821791449800517429801626548411186097020054274106289631332380896220073300682697206054462724924328343627424545203045888558675584509943613585498673806063774789641711677320950549404014453962232194357601778489618825099346633969720758417206991249081332730883499206300786824512167747434344091930679621676242297211166449613671057877940242369481545343160146563060522625900821064218728248191194593822552545894569037603346148216581933820400831759698819586781238662912715600185198893991335
iex(4)> b_pub_bin = :crypto.mod_pow(g, b_priv, p)
<<57, 14, 180, 20, 141, 196, 144, 220, 209, 194, 27, 90,
  142, 206, 209, 103, 82, 116, 35, 179, 61, 22, 39, 136,
  184, 135, 64, 223, 127, 91, 67, 221, 55, 64, 45, 47, 151,
  92, 104, 11, 176, 213, 73, 60, 41, 118, 223, 73, 83, 125,
  ...>>
iex(5)> b_pub = :binary.decode_unsigned(b_pub_bin)
7202833918882895413941488044670599667229863337239161342690220627829746114577669328793293789089814194612159772400716626359910616923378193304367488663437487013343244862475254488488006189128268200219147449689124128757901080330928092982518773675767660201032491378685154242406223787069045395511687708275760262854306386083557843944511558153383764526825815722191083211027593575970717325446980420287548767678034399825736230627872058934396248474935092342036232119452197598237720530137165021713859598209917717006950495685445193293137922852096939200218760628610232325496480264154932539926710448746823287613672825979828511687417
iex(6)> a_pub_received = 15468684771838238358932531496028223599028751769262450618321942259199011442712199219111290768666347378279484788157492711550727921297392113633793454804178539843057437315344298883184040610898184693677801731392201663410098578467049336760365664462694260410095405772150707764915531790421133264893762622705275797444533899472890261903255131401200519273058652187357611519927211650165834143520955642119960455105294562337102614397635631370149129046690845214202950926562528107115420010286461192355329940137038775796431499622525988185189283466873107209728861896338266832206689470334001461063471260341891607467287796477314659676677
15468684771838238358932531496028223599028751769262450618321942259199011442712199219111290768666347378279484788157492711550727921297392113633793454804178539843057437315344298883184040610898184693677801731392201663410098578467049336760365664462694260410095405772150707764915531790421133264893762622705275797444533899472890261903255131401200519273058652187357611519927211650165834143520955642119960455105294562337102614397635631370149129046690845214202950926562528107115420010286461192355329940137038775796431499622525988185189283466873107209728861896338266832206689470334001461063471260341891607467287796477314659676677
iex(7)> shared_bin_bob = :crypto.mod_pow(a_pub_received, b_priv, p)
<<47, 232, 80, 171, 32, 6, 99, 142, 39, 29, 206, 25, 65, 59,
  57, 178, 169, 112, 34, 255, 165, 140, 176, 53, 159, 64,
  202, 52, 10, 110, 74, 198, 112, 252, 166, 128, 165, 147,
  144, 24, 127, 143, 88, 12, 43, 55, 103, 251, 129, 116,
  ...>>
iex(8)> shared_int_bob = :binary.decode_unsigned(shared_bin_bob)
6047759184385469335156370811930744512345790997511266449321764769566423644869090071192385534942749590956534312244306929523110089101528933528047206435499678714592298714427879081456674026811116340356230630610171385140820703908563446330424349716984378196347448282180911695905543899104479615320901426655593284798373208264452945744335207584695216888684979041996427050611902522416147640873292026468973414070462485349907159864176780590718984043264446036720033125252773914606337925882738411182236955509210186077361440866441438886069197478131305510584433678398346078342488183359949710207160034112259943030407096425819679638795
```
